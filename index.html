<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>nodejs-tablesoccer-project</title>
  <link rel="stylesheet" href="app.css">
</head>
<body>
<h1>Tischkicker Node.js Projekt</h1>

<div style="float: left; padding: 100px; margin-top: 75px">
  <button id="plus1">+</button>
  <button id="minus1">-</button>
</div>
<div style="width: 100%">
  <div>
    <p id="countdown"></p>
  </div>
</div>
<div style="float: left; padding: 100px; font-size: 60px">
  <p id="GC-1">0</p>
</div>
<div style="float: left; padding: 100px; font-size: 60px">
  <p id="GC-2">0</p>
</div>
<div style="float: left; padding: 100px; margin-top: 75px">
  <button id="plus2">+</button>
  <button id="minus2">-</button>
</div>
<button id="reset">Spielstand zurücksetzen</button>
<button id="start">Spiel starten</button>
</body>
<footer>
  <a href="/settings">Einstellungen</a>
</footer>
<script src="/socket.io/socket.io.js"></script>
<script>
  /* const socket = io.connect('http://localhost:2301') */
  const socket = io();
  const whistle = new Audio('/sounds/whistle.ogg');
  const thirtySeconds = new Audio('/sounds/countdown-30-seconds.ogg');
  const tenSeconds = new Audio('/sounds/countdown-1.ogg');

  socket.on('connect', function (data) {

    socket.on('initialCountdown', function (playtime) {
      let minutes = Math.floor(playtime / 60);
      let seconds = playtime - minutes * 60;
      if (seconds < 10)
        document.getElementById('countdown').innerHTML = '0' + minutes + ':0' + seconds;
      else
        document.getElementById('countdown').innerHTML = '0' + minutes + ':' + seconds;
    })

    socket.on('startGame', function (data) {
      whistle.play();
    });

    socket.on('countdown', function (playtime) {
      let minutes = Math.floor(playtime / 60);
      let seconds = playtime - minutes * 60;

      if (seconds < 10)
        document.getElementById('countdown').innerHTML = '0' + minutes + ':0' + seconds;
      else
        document.getElementById('countdown').innerHTML = '0' + minutes + ':' + seconds;
      console.log(seconds);
    })

    socket.on('thirtySeconds', function () {
      console.log("30 Sekunden noch");
      thirtySeconds.play();
    })

    socket.on('tenSeconds', function () {
      console.log("10 Sekunden noch");
      tenSeconds.play();
    })


    socket.on('goalCount', function (data) {
      document.getElementById("GC-1").innerHTML = data.goalCountOne;
      document.getElementById("GC-2").innerHTML = data.goalCountTwo;
    });
  });

  document.getElementById('plus1').addEventListener('click', () => socket.emit('correctionOne', 1));
  document.getElementById('minus1').addEventListener('click', () => socket.emit('correctionOne', -1));
  document.getElementById('plus2').addEventListener('click', () => socket.emit('correctionTwo', 1));
  document.getElementById('minus2').addEventListener('click', () => socket.emit('correctionTwo', -1));
  document.getElementById('reset').addEventListener('click', () => confirm('Zurücksetzen bestätigen') && socket.emit('reset'));
  document.getElementById('start').addEventListener('click', () => socket.emit('start'));
</script>
</html>